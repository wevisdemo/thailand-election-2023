var $=Object.defineProperty;var x=(r,t,e)=>t in r?$(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var M=(r,t,e)=>(x(r,typeof t!="symbol"?t+"":t,e),e);import{w as L,d as _}from"./index.9e773dc6.js";import{b as k}from"./paths.1e0b5a22.js";import{p as E}from"./party.e98dd6ca.js";import{R as U}from"./index.495c775b.js";var D={},V={},A=34,y=10,O=13;function S(r){return new Function("d","return {"+r.map(function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'}).join(",")+"}")}function B(r,t){var e=S(r);return function(a,n){return t(e(a),n,r)}}function I(r){var t=Object.create(null),e=[];return r.forEach(function(a){for(var n in a)n in t||e.push(t[n]=n)}),e}function p(r,t){var e=r+"",a=e.length;return a<t?new Array(t-a+1).join(0)+e:e}function Y(r){return r<0?"-"+p(-r,6):r>9999?"+"+p(r,6):p(r,4)}function Z(r){var t=r.getUTCHours(),e=r.getUTCMinutes(),a=r.getUTCSeconds(),n=r.getUTCMilliseconds();return isNaN(r)?"Invalid Date":Y(r.getUTCFullYear())+"-"+p(r.getUTCMonth()+1,2)+"-"+p(r.getUTCDate(),2)+(n?"T"+p(t,2)+":"+p(e,2)+":"+p(a,2)+"."+p(n,3)+"Z":a?"T"+p(t,2)+":"+p(e,2)+":"+p(a,2)+"Z":e||t?"T"+p(t,2)+":"+p(e,2)+"Z":"")}function H(r){var t=new RegExp('["'+r+`
\r]`),e=r.charCodeAt(0);function a(o,s){var d,l,f=n(o,function(v,h){if(d)return d(v,h-1);l=v,d=s?B(v,s):S(v)});return f.columns=l||[],f}function n(o,s){var d=[],l=o.length,f=0,v=0,h,F=l<=0,w=!1;o.charCodeAt(l-1)===y&&--l,o.charCodeAt(l-1)===O&&--l;function b(){if(F)return V;if(w)return w=!1,D;var j,N=f,g;if(o.charCodeAt(N)===A){for(;f++<l&&o.charCodeAt(f)!==A||o.charCodeAt(++f)===A;);return(j=f)>=l?F=!0:(g=o.charCodeAt(f++))===y?w=!0:g===O&&(w=!0,o.charCodeAt(f)===y&&++f),o.slice(N+1,j-1).replace(/""/g,'"')}for(;f<l;){if((g=o.charCodeAt(j=f++))===y)w=!0;else if(g===O)w=!0,o.charCodeAt(f)===y&&++f;else if(g!==e)continue;return o.slice(N,j)}return F=!0,o.slice(N,l)}for(;(h=b())!==V;){for(var T=[];h!==D&&h!==V;)T.push(h),h=b();s&&(T=s(T,v++))==null||d.push(T)}return d}function i(o,s){return o.map(function(d){return s.map(function(l){return R(d[l])}).join(r)})}function u(o,s){return s==null&&(s=I(o)),[s.map(R).join(r)].concat(i(o,s)).join(`
`)}function c(o,s){return s==null&&(s=I(o)),i(o,s).join(`
`)}function m(o){return o.map(C).join(`
`)}function C(o){return o.map(R).join(r)}function R(o){return o==null?"":o instanceof Date?Z(o):t.test(o+="")?'"'+o.replace(/"/g,'""')+'"':o}return{parse:a,parseRows:n,format:u,formatBody:c,formatRows:m,formatRow:C,formatValue:R}}var J=H(","),Q=J.parse;function W(r){if(!r.ok)throw new Error(r.status+" "+r.statusText);return r.text()}function q(r,t){return fetch(r,t).then(W)}function z(r){return function(t,e,a){return arguments.length===2&&typeof e=="function"&&(a=e,e=void 0),q(t,e).then(function(n){return r(n,a)})}}var G=z(Q);class K{constructor(){M(this,"matrix");const t=U(E);this.matrix=this.createVoteFlowMatrix(t.list)}createVoteFlowMatrix(t){return t.reduce((e,a)=>({...e,[a.Name]:t.reduce((n,i)=>({...n,[i.Name]:a.Name===i.Name?1:0}),{})}),{})}updateVoteFlow(t,e,a){this.matrix[t][e]+=a,this.matrix[t][t]-=Object.entries(this.matrix[t]).reduce((n,[i,u])=>i===t?n:n+u,0)}applyVoteFlow(t){const e=U(E),a=Object.keys(this.matrix),n=a.reduce((u,c)=>{var m;return{...u,[c]:((m=t.find(({party:C})=>c===C.Name))==null?void 0:m.points)||0}},{}),i=t.reduce((u,{points:c})=>u+c,0);return a.map(u=>({party:e.map.get(u),points:a.reduce((c,m)=>c+n[m]*this.matrix[m][u],0)*i})).filter(({points:u})=>u>0).sort((u,c)=>c.points-u.points)}calculateVoteFlowResult(t){return Object.entries(t).reduce((e,[a,n])=>({...e,[a]:Object.entries(n).reduce((i,[u,c])=>c?{...i,[u]:this.applyVoteFlow(c)}:i,{})}),{})}}const X=`${k}/data/popularity-projection-2566.csv`;let P;const tt=()=>{const{subscribe:r,update:t}=L({});return{subscribe:r,load:async()=>{const e=U(E);P=(await G(X)).reduce((n,{province:i,electorialDistrictNumber:u,party:c,points:m})=>(n[i]||(n[i]={}),n[i][+u]||(n[i][+u]=[]),e.map.get(c)||E.add({Name:c}),n[i][+u].push({party:e.map.get(c),points:+m}),n),{}),t(()=>P)},calculate(){const e=new K;e.updateVoteFlow("พลังประชารัฐ","ก้าวไกล",.2),e.updateVoteFlow("พลังประชารัฐ","เพื่อไทย",.1),console.log(e.matrix.พลังประชารัฐ),t(()=>e.calculateVoteFlowResult(P))}}},rt=tt(),it=_(rt,r=>{const t={};return Object.values(r).forEach(e=>Object.values(e).forEach(a=>{const{party:n}=a[0];n&&(t[n.Name]||(t[n.Name]={party:n,fromDistrict:0,fromPartylist:0,total:0}),t[n.Name].fromDistrict++,t[n.Name].fromPartylist++,t[n.Name].total+=2)})),Object.values(t).sort((e,a)=>a.total-e.total)});export{G as c,rt as d,it as r};
